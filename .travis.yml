language: android

env:
  global:
    - BORINGSSL_HOME="$HOME/boringssl"
    - CC=clang
    - CXX=clang++
    - CXXFLAGS="-std=c++11"
    - GOOGLE_JAVA_FORMAT_VERSION=1.1

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/dists/

matrix:
  include:
    ###
    ### Linux build is the only platform that builds Android here.
    ###
    - os: linux
      jdk: oraclejdk8
      sudo: false

      env:
        - ANDROID_TOOLS_URL="https://dl.google.com/android/repository/tools_r25.2.3-linux.zip"
        - ANDROID_HOME="$HOME/android-sdk-linux"
        - ANDROID_NDK_HOME="$ANDROID_HOME/ndk-bundle"
        - JAVA6_HOME=/usr/lib/jvm/java-6-openjdk-amd64

      addons:
        apt:
          sources:
            - kalakris-cmake
            - llvm-toolchain-precise-3.9  # for clang-format-3.9
            - ubuntu-toolchain-r-test
          packages:
            - openjdk-6-jre # for running tests with Java 6

    ###
    ### MacOS build only does x86-64.
    ###
    - os: osx
      osx_image: xcode8
      before_install:
        - brew update
        - brew install ninja
        - export JAVA_HOME=`/usr/libexec/java_home -v 1.8`

before_cache:
  - find $HOME/.gradle -name "*.lock" -exec rm {} \;
  - rm -rf $HOME/.gradle/caches/[1-9]*

script:
  - ${JAVA_HOME}/bin/java -XshowSettings:properties -version;

after_script:
  - "[ -f android/build/outputs/lint-results-debug.xml ] && cat android/build/outputs/lint-results-debug.xml"
